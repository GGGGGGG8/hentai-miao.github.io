<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React 整理手册 | 绅士喵呜的技术博客</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="  ">
    <link rel="preload" href="/assets/css/0.styles.e7d7bc45.css" as="style"><link rel="preload" href="/assets/js/app.f09e1a8f.js" as="script"><link rel="preload" href="/assets/js/3.6380eba5.js" as="script"><link rel="preload" href="/assets/js/1.86ff7d31.js" as="script"><link rel="preload" href="/assets/js/83.93f4c999.js" as="script"><link rel="prefetch" href="/assets/js/10.5517d1b6.js"><link rel="prefetch" href="/assets/js/100.92371dc9.js"><link rel="prefetch" href="/assets/js/11.0573e311.js"><link rel="prefetch" href="/assets/js/12.0875f58d.js"><link rel="prefetch" href="/assets/js/13.71642ae4.js"><link rel="prefetch" href="/assets/js/14.36f8acdb.js"><link rel="prefetch" href="/assets/js/15.6215165a.js"><link rel="prefetch" href="/assets/js/16.485c8436.js"><link rel="prefetch" href="/assets/js/17.03710596.js"><link rel="prefetch" href="/assets/js/18.1935d804.js"><link rel="prefetch" href="/assets/js/19.1389efb6.js"><link rel="prefetch" href="/assets/js/20.083b5e26.js"><link rel="prefetch" href="/assets/js/21.6074112f.js"><link rel="prefetch" href="/assets/js/22.7ee932d9.js"><link rel="prefetch" href="/assets/js/23.b5b2417f.js"><link rel="prefetch" href="/assets/js/24.16e24b97.js"><link rel="prefetch" href="/assets/js/25.c0f615e7.js"><link rel="prefetch" href="/assets/js/26.54e45f38.js"><link rel="prefetch" href="/assets/js/27.1a2c9280.js"><link rel="prefetch" href="/assets/js/28.b770ec38.js"><link rel="prefetch" href="/assets/js/29.acca8bd0.js"><link rel="prefetch" href="/assets/js/30.d2532d72.js"><link rel="prefetch" href="/assets/js/31.eb2b3d90.js"><link rel="prefetch" href="/assets/js/32.6565c348.js"><link rel="prefetch" href="/assets/js/33.c7bc65b2.js"><link rel="prefetch" href="/assets/js/34.1bf2f3da.js"><link rel="prefetch" href="/assets/js/35.d3385f69.js"><link rel="prefetch" href="/assets/js/36.5cfe3ec3.js"><link rel="prefetch" href="/assets/js/37.26aef80a.js"><link rel="prefetch" href="/assets/js/38.a35b1680.js"><link rel="prefetch" href="/assets/js/39.8a99a996.js"><link rel="prefetch" href="/assets/js/4.8ca4a540.js"><link rel="prefetch" href="/assets/js/40.3ccc91a6.js"><link rel="prefetch" href="/assets/js/41.d6b84276.js"><link rel="prefetch" href="/assets/js/42.bf751eb9.js"><link rel="prefetch" href="/assets/js/43.410217ff.js"><link rel="prefetch" href="/assets/js/44.1500d4ec.js"><link rel="prefetch" href="/assets/js/45.37818d2d.js"><link rel="prefetch" href="/assets/js/46.e865b48f.js"><link rel="prefetch" href="/assets/js/47.e854ab11.js"><link rel="prefetch" href="/assets/js/48.28bcbd91.js"><link rel="prefetch" href="/assets/js/49.cb7462d2.js"><link rel="prefetch" href="/assets/js/5.3153c171.js"><link rel="prefetch" href="/assets/js/50.2217c9c1.js"><link rel="prefetch" href="/assets/js/51.cfadb2b8.js"><link rel="prefetch" href="/assets/js/52.752ecedc.js"><link rel="prefetch" href="/assets/js/53.7c8e434c.js"><link rel="prefetch" href="/assets/js/54.ec8b8cb9.js"><link rel="prefetch" href="/assets/js/55.e86e5fbd.js"><link rel="prefetch" href="/assets/js/56.19995147.js"><link rel="prefetch" href="/assets/js/57.c3f8dd98.js"><link rel="prefetch" href="/assets/js/58.d0d3ab90.js"><link rel="prefetch" href="/assets/js/59.04d9b9ea.js"><link rel="prefetch" href="/assets/js/6.f20cbf4e.js"><link rel="prefetch" href="/assets/js/60.1b51b1c9.js"><link rel="prefetch" href="/assets/js/61.ca052798.js"><link rel="prefetch" href="/assets/js/62.dbb692ec.js"><link rel="prefetch" href="/assets/js/63.f254ed9a.js"><link rel="prefetch" href="/assets/js/64.f27c1117.js"><link rel="prefetch" href="/assets/js/65.da43f37a.js"><link rel="prefetch" href="/assets/js/66.ac41ad1b.js"><link rel="prefetch" href="/assets/js/67.139f543f.js"><link rel="prefetch" href="/assets/js/68.9281c085.js"><link rel="prefetch" href="/assets/js/69.bec927a5.js"><link rel="prefetch" href="/assets/js/7.08bf542b.js"><link rel="prefetch" href="/assets/js/70.db0613c6.js"><link rel="prefetch" href="/assets/js/71.0c3d0498.js"><link rel="prefetch" href="/assets/js/72.aee3f326.js"><link rel="prefetch" href="/assets/js/73.76f9ab8f.js"><link rel="prefetch" href="/assets/js/74.03ec551c.js"><link rel="prefetch" href="/assets/js/75.96bd35fd.js"><link rel="prefetch" href="/assets/js/76.8eea9d5c.js"><link rel="prefetch" href="/assets/js/77.13908ef5.js"><link rel="prefetch" href="/assets/js/78.609cb13a.js"><link rel="prefetch" href="/assets/js/79.0d4df250.js"><link rel="prefetch" href="/assets/js/8.215181eb.js"><link rel="prefetch" href="/assets/js/80.73ae2e4f.js"><link rel="prefetch" href="/assets/js/81.3927ddde.js"><link rel="prefetch" href="/assets/js/82.86b457e2.js"><link rel="prefetch" href="/assets/js/84.91f0b5d9.js"><link rel="prefetch" href="/assets/js/85.0e943352.js"><link rel="prefetch" href="/assets/js/86.82041574.js"><link rel="prefetch" href="/assets/js/87.5dd34590.js"><link rel="prefetch" href="/assets/js/88.e36c88ec.js"><link rel="prefetch" href="/assets/js/89.ded599d3.js"><link rel="prefetch" href="/assets/js/9.89288b36.js"><link rel="prefetch" href="/assets/js/90.60714017.js"><link rel="prefetch" href="/assets/js/91.06074398.js"><link rel="prefetch" href="/assets/js/92.26998e97.js"><link rel="prefetch" href="/assets/js/93.3bcbb0d7.js"><link rel="prefetch" href="/assets/js/94.bf2a69b4.js"><link rel="prefetch" href="/assets/js/95.dd3b1169.js"><link rel="prefetch" href="/assets/js/96.26bbe59b.js"><link rel="prefetch" href="/assets/js/97.b883aa89.js"><link rel="prefetch" href="/assets/js/98.cc07f12e.js"><link rel="prefetch" href="/assets/js/99.d38481a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e7d7bc45.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>绅士喵呜的技术博客</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>hentaimiao</span>
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">绅士喵呜的技术博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/backEnd/" class="nav-link"><i class="iconfont undefined"></i>
  backEnd
</a></li><li class="dropdown-item"><!----> <a href="/categories/frontEnd/" class="nav-link"><i class="iconfont undefined"></i>
  frontEnd
</a></li><li class="dropdown-item"><!----> <a href="/categories/software/" class="nav-link"><i class="iconfont undefined"></i>
  software
</a></li><li class="dropdown-item"><!----> <a href="/categories/http/" class="nav-link"><i class="iconfont undefined"></i>
  http
</a></li><li class="dropdown-item"><!----> <a href="/categories/建造中/" class="nav-link"><i class="iconfont undefined"></i>
  建造中
</a></li><li class="dropdown-item"><!----> <a href="/categories/react/" class="nav-link"><i class="iconfont undefined"></i>
  react
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      前端学习
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/html/" class="nav-link"><i class="iconfont undefined"></i>
  HTML
</a></li><li class="dropdown-subitem"><a href="/frontEnd/css/" class="nav-link"><i class="iconfont undefined"></i>
  CSS
</a></li><li class="dropdown-subitem"><a href="/frontEnd/js/" class="nav-link"><i class="iconfont undefined"></i>
  JS
</a></li><li class="dropdown-subitem"><a href="/frontEnd/es6/" class="nav-link"><i class="iconfont undefined"></i>
  ES6
</a></li></ul></li><li class="dropdown-item"><h4>动画</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/greensock/" class="nav-link"><i class="iconfont undefined"></i>
  GreenSock
</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-subitem"><a href="/frontEnd/react/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  React
</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/axios/" class="nav-link"><i class="iconfont undefined"></i>
  Axios
</a></li><li class="dropdown-subitem"><a href="/frontEnd/TypeScript/" class="nav-link"><i class="iconfont undefined"></i>
  TypeScript
</a></li><li class="dropdown-subitem"><a href="/webpack/" class="nav-link"><i class="iconfont undefined"></i>
  Webpack
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      后端探索
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backEnd/http/" class="nav-link"><i class="iconfont undefined"></i>
  http
</a></li><li class="dropdown-item"><!----> <a href="/backEnd/node/" class="nav-link"><i class="iconfont undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link"><i class="iconfont undefined"></i>
  其他
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      软件开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backEnd/git/" class="nav-link"><i class="iconfont undefined"></i>
  Git版本控制
</a></li><li class="dropdown-item"><!----> <a href="/development/agile/" class="nav-link"><i class="iconfont undefined"></i>
  敏捷开发
</a></li></ul></div></div> <a href="https://github.com/hentai-miao/blog-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    hentaimiao
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>66</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>18</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/backEnd/" class="nav-link"><i class="iconfont undefined"></i>
  backEnd
</a></li><li class="dropdown-item"><!----> <a href="/categories/frontEnd/" class="nav-link"><i class="iconfont undefined"></i>
  frontEnd
</a></li><li class="dropdown-item"><!----> <a href="/categories/software/" class="nav-link"><i class="iconfont undefined"></i>
  software
</a></li><li class="dropdown-item"><!----> <a href="/categories/http/" class="nav-link"><i class="iconfont undefined"></i>
  http
</a></li><li class="dropdown-item"><!----> <a href="/categories/建造中/" class="nav-link"><i class="iconfont undefined"></i>
  建造中
</a></li><li class="dropdown-item"><!----> <a href="/categories/react/" class="nav-link"><i class="iconfont undefined"></i>
  react
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      前端学习
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/html/" class="nav-link"><i class="iconfont undefined"></i>
  HTML
</a></li><li class="dropdown-subitem"><a href="/frontEnd/css/" class="nav-link"><i class="iconfont undefined"></i>
  CSS
</a></li><li class="dropdown-subitem"><a href="/frontEnd/js/" class="nav-link"><i class="iconfont undefined"></i>
  JS
</a></li><li class="dropdown-subitem"><a href="/frontEnd/es6/" class="nav-link"><i class="iconfont undefined"></i>
  ES6
</a></li></ul></li><li class="dropdown-item"><h4>动画</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/greensock/" class="nav-link"><i class="iconfont undefined"></i>
  GreenSock
</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-subitem"><a href="/frontEnd/react/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  React
</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/axios/" class="nav-link"><i class="iconfont undefined"></i>
  Axios
</a></li><li class="dropdown-subitem"><a href="/frontEnd/TypeScript/" class="nav-link"><i class="iconfont undefined"></i>
  TypeScript
</a></li><li class="dropdown-subitem"><a href="/webpack/" class="nav-link"><i class="iconfont undefined"></i>
  Webpack
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      后端探索
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backEnd/http/" class="nav-link"><i class="iconfont undefined"></i>
  http
</a></li><li class="dropdown-item"><!----> <a href="/backEnd/node/" class="nav-link"><i class="iconfont undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link"><i class="iconfont undefined"></i>
  其他
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      软件开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backEnd/git/" class="nav-link"><i class="iconfont undefined"></i>
  Git版本控制
</a></li><li class="dropdown-item"><!----> <a href="/development/agile/" class="nav-link"><i class="iconfont undefined"></i>
  敏捷开发
</a></li></ul></div></div> <a href="https://github.com/hentai-miao/blog-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <ul class="sidebar-links"><li><a href="/frontEnd/react/" aria-current="page" class="sidebar-link">React.js 可视化编辑工具</a></li><li><a href="/frontEnd/react/react01.html" aria-current="page" class="active sidebar-link">React 整理手册</a></li><li><a href="/frontEnd/react/react02.html" class="sidebar-link">React Hooks 体系设计</a></li><li><a href="/frontEnd/react/react03.html" class="sidebar-link">Immer.js 精读</a></li><li><a href="/frontEnd/react/react04.html" class="sidebar-link">使用 Immer 优化 Reducer</a></li><li><a href="/frontEnd/react/react05.html" class="sidebar-link">使用 useReducer 和 TypeScript 优化 React 上下文</a></li><li><a href="/frontEnd/react/react06.html" class="sidebar-link">react 中防抖函数的实现</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>React 整理手册</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>hentaimiao</span>
            
          <!---->
          2020
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>React 整理手册</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>hentaimiao</span></i> <i class="iconfont reco-date" data-v-3b7f5bdf><span data-v-3b7f5bdf>2020-06-30</span></i> <!----> <i class="iconfont reco-tag tags" data-v-3b7f5bdf><span class="tag-item" data-v-3b7f5bdf>React</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><p>React 是一个声明式，高效且灵活的用于构建用户界面的 JavaScript 库。使用 React 可以将一些简短、独立的代码片段组合成复杂的 UI 界面，这些代码片段被称作“组件”。
</p> <h2 id="react-入门"><a href="#react-入门" aria-hidden="true" class="header-anchor">#</a> React 入门</h2> <p>用于构建用户界面的 JavaScript 库</p> <h3 id="目标"><a href="#目标" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <p>掌握 create-react-app 的使用</p> <h3 id="资源"><a href="#资源" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <ol><li><a href="https://zh-hans.reactjs.org/" target="_blank" rel="noopener noreferrer">React<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://facebook.github.io/create-react-app/docs/getting-started" target="_blank" rel="noopener noreferrer">create-react-app<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <h3 id="起步"><a href="#起步" aria-hidden="true" class="header-anchor">#</a> 起步</h3> <ol><li>创建项目 <code>npx creacte-react-app my-app</code></li> <li>打开项目 <code>cd my-app</code></li> <li>启动项目 <code>yarn start</code></li> <li>暴露配置项 <code>npm run eject</code> （不可逆）</li></ol> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gga4sxe7jkj30fg0d275y.jpg" alt="image-20200630105956411"></p> <h3 id="文件目录"><a href="#文件目录" aria-hidden="true" class="header-anchor">#</a> 文件目录</h3> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gga5qvxt9pj306n06raab.jpg" alt="image-20200630113237873"></p> <h3 id="cra-文件结构"><a href="#cra-文件结构" aria-hidden="true" class="header-anchor">#</a> CRA 文件结构</h3> <div class="language- extra-class"><pre class="language-text"><code>├── README.md 						⽂档
├── public 								静态资源
│ ├── favicon.ico 
│ ├── index.html 
│ └── manifest.json 
└── src										源码
	├── App.css
	├── App.js							根组件
	├── App.test.js
	├── index.css						全局样式
	├── index.js						⼊⼝⽂件
	├── logo.svg
	└── serviceWorker.js 		pwa⽀持
├── package.json					npm 依赖
</code></pre></div><h3 id="入口文件-index-js-简单介绍"><a href="#入口文件-index-js-简单介绍" aria-hidden="true" class="header-anchor">#</a> 入口文件 <code>index.js</code> 简单介绍</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// React 负责逻辑控制，数据 -&gt; VDOM</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token comment">// ReactDOM 渲染实际 DOM，VDOM -&gt; DOM</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> serviceWorker <span class="token keyword">from</span> <span class="token string">'./serviceWorker'</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>StrictMode<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>StrictMode<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// If you want your app to work offline and load faster, you can change</span>
<span class="token comment">// unregister() to register() below. Note this comes with some pitfalls.</span>
<span class="token comment">// Learn more about service workers: https://bit.ly/CRA-PWA</span>
serviceWorker<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><ul><li><code>import React from 'react';</code>：<em>React 负责逻辑控制，数据 -&gt; VDOM</em></li> <li><code>import ReactDOM from 'react-dom';</code>：ReactDOM 负责渲染实际 DOM，VDOM -&gt; DOM</li> <li><code>import App from './App';</code>：<code>App.js</code> 文件，根模板，将这个对象的虚拟 DOM 渲染成真实 DOM 后插入到 <code>root div</code> 中，我们可以在 <code>index.html</code> 文件中看到 <code>root div</code></li> <li><code>App.js</code>：返回一个 HTML 片段，使用 JSX 语法</li></ul> <h3 id="入口文件-webpack-config-js-定义"><a href="#入口文件-webpack-config-js-定义" aria-hidden="true" class="header-anchor">#</a> ⼊⼝⽂件 <code>webpack.conﬁg.js</code> 定义：</h3> <div class="language-js extra-class"><pre class="language-js"><code>entry<span class="token punctuation">:</span> <span class="token punctuation">[</span> 
<span class="token comment">// WebpackDevServer客户端，它实现开发时热更新功能 </span>
isEnvDevelopment <span class="token operator">&amp;&amp;</span> 
require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'react-dev-utils/webpackHotDevClient'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token comment">// 应⽤程序⼊⼝：src/index </span>
paths<span class="token punctuation">.</span>appIndexJs<span class="token punctuation">,</span> 
<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>webpack.conﬁg.js 是 webpack 配置⽂件，开头的常量声明可以看出 cra 能够⽀持 ts、sass 及 css 模块化。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Check if TypeScript is setup </span>
<span class="token keyword">const</span> useTypeScript <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>appTsConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// style files regexes </span>
<span class="token keyword">const</span> cssRegex <span class="token operator">=</span> <span class="token regex">/\.css$/</span><span class="token punctuation">;</span> 
<span class="token keyword">const</span> cssModuleRegex <span class="token operator">=</span> <span class="token regex">/\.module\.css$/</span><span class="token punctuation">;</span> 
<span class="token keyword">const</span> sassRegex <span class="token operator">=</span> <span class="token regex">/\.(scss|sass)$/</span><span class="token punctuation">;</span> 
<span class="token keyword">const</span> sassModuleRegex <span class="token operator">=</span> <span class="token regex">/\.module\.(scss|sass)$/</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="react-和-reactdom"><a href="#react-和-reactdom" aria-hidden="true" class="header-anchor">#</a> React 和 ReactDOM</h3> <p>删除 src 下⾯所有代码，新建 index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token comment">// 这⾥怎么没有出现React字眼？ </span>
<span class="token comment">// JSX =&gt; React.createElement(...)</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello React<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>React 负责逻辑控制，数据 -&gt; VDOM</p> <p>ReactDOM 渲染实际 DOM，VDOM -&gt; DOM</p> <p>React 使⽤ JSX 来描述 UI</p> <p>babel-loader 把 JSX 编译成相应的 JS 对象，React.createElement 再把这个 JS 对象构造成 React 需要的虚拟 DOM</p></blockquote> <h2 id="jsx-语法"><a href="#jsx-语法" aria-hidden="true" class="header-anchor">#</a> JSX 语法</h2> <p>它被称为 JSX，是一个 JavaScript 的语法扩展。我们建议在 React 中配合使用 JSX，JSX 可以很好地描述 UI 应该呈现出它应有交互的本质形式。JSX 可能会使人联想到模版语言，但它具有 JavaScript 的全部功能。</p> <h3 id="目标-2"><a href="#目标-2" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <p>掌握 JSX 语法</p> <h3 id="资源-2"><a href="#资源-2" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <p><a href="https://zh-hans.reactjs.org/docs/introducing-jsx.html" target="_blank" rel="noopener noreferrer">JSX 简介<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="起步-2"><a href="#起步-2" aria-hidden="true" class="header-anchor">#</a> 起步</h3> <h3 id="jsx"><a href="#jsx" aria-hidden="true" class="header-anchor">#</a> JSX</h3> <p>JSX 是一种 JavaScript 的语法扩展，其格式比较像模板语言，但事实上完全是在 JavaScript 内部实现的</p> <p>JSX 可以很好地描述 UI，能够提高开发效率</p> <h3 id="基本使用"><a href="#基本使用" aria-hidden="true" class="header-anchor">#</a> 基本使用</h3> <p>表达式 <code>{}</code> 的使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">&quot;react study&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">const</span> jsx <span class="token operator">=</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hello<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="函数"><a href="#函数" aria-hidden="true" class="header-anchor">#</a> 函数</h3> <p>函数是合法表达式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
	firstName<span class="token punctuation">:</span> <span class="token string">'Harry'</span>
  lastName<span class="token punctuation">:</span> <span class="token string">'Potter'</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">formatName</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> name<span class="token punctuation">.</span>fristName <span class="token operator">+</span> <span class="token string">''</span> <span class="token operator">+</span> name<span class="token punctuation">.</span>lastName
<span class="token punctuation">}</span>
<span class="token keyword">const</span> jsx <span class="token operator">=</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span> <span class="token function">formatName</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><h3 id="对象"><a href="#对象" aria-hidden="true" class="header-anchor">#</a> 对象</h3> <p>JSX 是 JS 对象，是合法表达是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> greet <span class="token operator">=</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>good<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token keyword">const</span> jsx <span class="token operator">=</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span> greet <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><h3 id="条件语句"><a href="#条件语句" aria-hidden="true" class="header-anchor">#</a> 条件语句</h3> <p>条件语句可以基于以上概念实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> show <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// false</span>
<span class="token keyword">const</span> greet <span class="token operator">=</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>good<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token keyword">const</span> jsx <span class="token operator">=</span> <span class="token punctuation">(</span>
	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">{</span><span class="token comment">/* 条件语句 */</span><span class="token punctuation">}</span>
		<span class="token punctuation">{</span>show <span class="token operator">?</span> greet <span class="token punctuation">:</span> <span class="token string">'登录'</span> <span class="token punctuation">}</span>
		<span class="token punctuation">{</span>show <span class="token operator">&amp;&amp;</span> greet<span class="token punctuation">}</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="数组"><a href="#数组" aria-hidden="true" class="header-anchor">#</a> 数组</h3> <p>数组会被作为一组子元素对待，数组中存放一组 JSX 可用于显示列表数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> jsx <span class="token operator">=</span> <span class="token punctuation">(</span>
	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">{</span><span class="token comment">/* 数组 */</span><span class="token punctuation">}</span>
		<span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
			<span class="token punctuation">{</span><span class="token comment">/*diff 时候，首先比较 type，然后是 key，所以同级同类型的元素，key 值必须得唯一*/</span><span class="token punctuation">}</span>
			<span class="token punctuation">{</span>a<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
				<span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
			<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="属性的使用"><a href="#属性的使用" aria-hidden="true" class="header-anchor">#</a> 属性的使用</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">&quot;./logo.svg&quot;</span>

<span class="token keyword">const</span> jsx <span class="token operator">=</span> <span class="token punctuation">(</span>
	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
		<span class="token punctuation">{</span><span class="token comment">/* 属性：静态值⽤双引号，动态值⽤花括号；class、for 等要特殊处理。 */</span><span class="token punctuation">}</span> 
		<span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>logo<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;img&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span> 
	<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
<span class="token punctuation">)</span>
</code></pre></div><h3 id="模块化"><a href="#模块化" aria-hidden="true" class="header-anchor">#</a> 模块化</h3> <p>css 模块化，创建 index.module.css，index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">&quot;./index.module.css&quot;</span>
<span class="token operator">&lt;</span>img className<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">.</span>logo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p><code>npm install sass -D</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">&quot;./index.module.scss&quot;</span>
<span class="token operator">&lt;</span>img className<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">.</span>logo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><h2 id="组件"><a href="#组件" aria-hidden="true" class="header-anchor">#</a> 组件</h2> <h3 id="目标-3"><a href="#目标-3" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <p>掌握组件使用</p> <h3 id="资源-3"><a href="#资源-3" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <p><a href="https://zh-hans.reactjs.org/docs/components-and-props.html" target="_blank" rel="noopener noreferrer">组件 &amp; Props<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="起步-3"><a href="#起步-3" aria-hidden="true" class="header-anchor">#</a> 起步</h3> <h3 id="组件-2"><a href="#组件-2" aria-hidden="true" class="header-anchor">#</a> 组件</h3> <p>从概念上类似于 JavaScript 函数，它接受任意的入参（&quot;props&quot;），并返回用于描述页面展示内容的 React 元素</p> <p>两种形式：</p> <ul><li><code>class 组件</code></li> <li><code>function 组件</code></li></ul> <h3 id="class-组件"><a href="#class-组件" aria-hidden="true" class="header-anchor">#</a> class 组件</h3> <p><code>class</code> 组件通常拥有状态和生命周期，继承于 <code>Component</code>，实现 <code>render</code> 方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一个 Clock 组件</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">ClassComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 使⽤state属性维护状态，在构造函数中初始化状态 </span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 组件挂载之后启动定时器每秒更新状态</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timerID <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    	<span class="token comment">// 使⽤setState⽅法更新状态</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token comment">// 组件卸载前停⽌定时器</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timerID<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;componentDidUpdate&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="function-组件"><a href="#function-组件" aria-hidden="true" class="header-anchor">#</a> function 组件</h3> <p>函数组件通常无状态，仅关注内容展示，返回渲染结果即可</p> <blockquote><p>从 React 16.8 开始引入了 hooks，函数组件也能够拥有状态</p></blockquote> <p>用 function 组件创建一个 Clock</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">FunctionComponent</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span>date<span class="token punctuation">,</span> setDate<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">//副作⽤ </span>
		<span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
      <span class="token function">setDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//组件卸载的时候执⾏ </span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span> 
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>FunctionComponent<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>date<span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>提示: 如果你熟悉 React class 的⽣命周期函数，你可以把 useEffect Hook 看做 componentDidMount ， componentDidUpdate 和 componentWillUnmount 三个函数的组合。</p> <p>hooks api 后⾯会继续深⼊讲解。</p></blockquote> <h2 id="正确使用-setstate"><a href="#正确使用-setstate" aria-hidden="true" class="header-anchor">#</a> 正确使用 setState</h2> <h3 id="目标-4"><a href="#目标-4" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <p>掌握 setState 的用法</p> <h3 id="资源-4"><a href="#资源-4" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <p><a href="https://zh-hans.reactjs.org/docs/state-and-lifecycle.html" target="_blank" rel="noopener noreferrer">State &amp; 生命周期<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="起步-4"><a href="#起步-4" aria-hidden="true" class="header-anchor">#</a> 起步</h3> <h3 id="正确使用-setstate-2"><a href="#正确使用-setstate-2" aria-hidden="true" class="header-anchor">#</a> 正确使用 setState</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setState</span><span class="token punctuation">(</span>partialState<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre></div><ol><li><code>partialState</code>：object | function -- 用于产生与当前 <code>state</code> 合并的子集</li> <li><code>callback</code>：function -- state 更新之后被调用</li></ol> <h3 id="关于-setstate-应该了解的"><a href="#关于-setstate-应该了解的" aria-hidden="true" class="header-anchor">#</a> 关于 <code>setState()</code> 应该了解的</h3> <h3 id="不要直接修改-state"><a href="#不要直接修改-state" aria-hidden="true" class="header-anchor">#</a> 不要直接修改 State</h3> <p>例如，此代码不会重新渲染组件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 错误示范 </span>
<span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>comment <span class="token operator">=</span> <span class="token string">'Hello'</span><span class="token punctuation">;</span>
</code></pre></div><p>⽽是应该使⽤ setState() :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 正确使⽤ </span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>comment<span class="token punctuation">:</span> 'Hell
</code></pre></div><h3 id="state-的更新可能是异步的"><a href="#state-的更新可能是异步的" aria-hidden="true" class="header-anchor">#</a> State 的更新可能是异步的</h3> <p>出于性能考虑，React 可能会把多个 <code>setState()</code> 调⽤合并成⼀个调⽤。</p> <p>观察以下例⼦中 log 的值和 button 显示的 counter。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">SetStatePage</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span> 
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
		<span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> 
			counter<span class="token punctuation">:</span> <span class="token number">0</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

	<span class="token function-variable function">changeValue</span> <span class="token operator">=</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token comment">// 并没有同步更新，得到的是上一次的值</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> counter<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> v <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;counter&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token function-variable function">setCounter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//this.changeValue(2); </span>
    <span class="token comment">//console.log(&quot;counter&quot;, this.state.counter); </span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">const</span> <span class="token punctuation">{</span> counter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span> 
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      	<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>SetStatePage<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>setCounter<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>counter<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果要获得最新状态值有以下方式：</p> <ol><li><p>在回调中获取状态值，使用 setState 的结构，callback 参数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">changeValue</span> <span class="token operator">=</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> counter<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">+</span> v <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'counter'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>使用定时器</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>原生状态中修改状态</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">componentDisMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>changeValue<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <blockquote><p>总结： setState 只有在合成事件和生命周期函数中是异步的，在原生事件和 setTimeout 中都是同步的，这里的异步其实是批量更新。</p></blockquote> <h3 id="state-的更新会被合并"><a href="#state-的更新会被合并" aria-hidden="true" class="header-anchor">#</a> State 的更新会被合并</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">changeValue</span> <span class="token operator">=</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    counter<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> v 
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token function-variable function">setCounter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 后者覆盖前者，因为 key 相同，改的是同一个值Ò</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>如果想要链式更新 state：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">changeValue</span> <span class="token operator">=</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> counter<span class="token punctuation">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> v <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token function-variable function">setCounter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="生命周期"><a href="#生命周期" aria-hidden="true" class="header-anchor">#</a> 生命周期</h2> <h3 id="目标-5"><a href="#目标-5" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <ul><li>掌握组件生命周期</li></ul> <h3 id="资源-5"><a href="#资源-5" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <ul><li><p><a href="https://zh-hans.reactjs.org/docs/react-component.html#the-component-lifecycle" target="_blank" rel="noopener noreferrer">组件的生命周期<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/" target="_blank" rel="noopener noreferrer">生命周期图谱<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h3 id="知识要点"><a href="#知识要点" aria-hidden="true" class="header-anchor">#</a> 知识要点</h3> <h3 id="生命周期方法"><a href="#生命周期方法" aria-hidden="true" class="header-anchor">#</a> 生命周期方法</h3> <p>生命周期方法，用于在不同组件不同阶段执行自定义功能。在组件被创建并插入到 DOM 时（挂载中阶段 mounting），组件更新时，组件取消挂载或从 DOM 中删除时，都有可以使用的声明周期方法。</p> <h3 id="v16-3-之前的生命周期"><a href="#v16-3-之前的生命周期" aria-hidden="true" class="header-anchor">#</a> v16.3 之前的生命周期</h3> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggab8gqkx3j30ec0jjdkj.jpg" alt="image-20200630144249308"></p> <h3 id="v16-4-之后的生命周期"><a href="#v16-4-之后的生命周期" aria-hidden="true" class="header-anchor">#</a> v16.4 之后的生命周期</h3> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggab93eqhbj30v10f3jt6.jpg" alt="image-20200630144330061"></p> <p>V17可能会废弃的三个⽣命周期函数⽤ getDerivedStateFromProps 替代，⽬前使⽤的话加上 UNSAFE_：</p> <ul><li>componentWillMount</li> <li>componentWillReceiveProps</li> <li>componentWillUpdate</li></ul> <p>引⼊两个新的⽣命周期函数：</p> <ul><li><p>static getDerivedStateFromProps</p></li> <li><p>getSnapshotBeforeUpdate</p></li></ul> <p>如果不想⼿动给将要废弃的⽣命周期添加 UNSAFE_ 前缀，可以⽤下⾯的命令：</p> <div class="language-js extra-class"><pre class="language-js"><code>npx react<span class="token operator">-</span>codemod rename<span class="token operator">-</span>unsafe<span class="token operator">-</span>lifecycles <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>
</code></pre></div><h3 id="新引入的两个生命周期"><a href="#新引入的两个生命周期" aria-hidden="true" class="header-anchor">#</a> 新引入的两个生命周期</h3> <h3 id="getderivedstatefromprops"><a href="#getderivedstatefromprops" aria-hidden="true" class="header-anchor">#</a> getDerivedStateFromProps</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
</code></pre></div><p><code>getDerivedStateFromProps</code> 会在调用 <code>render()</code> 方法之前调用，并且在挂载及后续更新时都会被调用。它返回一个对象来更新 state，如果返回 null 则不更新任何内容</p> <p>请注意，不管原因是什么，都会在每次渲染前触发此方法，这与 <code>UNSAFE_componentWillReceiveProps</code> 形成对比，后者在父组件重新渲染时触发，而不是在内部调用 <code>setState</code> 时</p> <h3 id="getsnapshotbeforeupdate"><a href="#getsnapshotbeforeupdate" aria-hidden="true" class="header-anchor">#</a> getSnapshotBeforeUpdate</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">)</span>
</code></pre></div><p>在 <code>render()</code> 之后，在 <code>componentDidUpdate</code> 之前</p> <p><code>getSnapshotBeforeUpdate()</code> 在最近一次渲染输出（提交到 DOM 节点）之前调用，它使得组件能在发生更改之前从 DOM 中捕获一些信息（例如，滚动位置）。此生命周期的任何返回值将作为参数传递给 <code>componentDidUpdate(prevProps, prevState, snapshot)</code></p> <h3 id="验证生命周期"><a href="#验证生命周期" aria-hidden="true" class="header-anchor">#</a> 验证生命周期</h3> <p>范例：创建 <code>LifeCyclePage.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">&quot;prop-types&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">/* 
	V17可能会废弃的三个⽣命周期函数⽤getDerivedStateFromProps替代，⽬前使⽤的话加上 
	UNSAFE_：
		- componentWillMount
		- componentWillReceiveProps
		- componentWillUpdate 
*/</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">LifeCyclePage</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span> 
  <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span> 
    msg<span class="token punctuation">:</span> <span class="token string">&quot;omg&quot;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
	<span class="token keyword">static</span> propTypes <span class="token operator">=</span> <span class="token punctuation">{</span> 
    msg<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">.</span>isRequired 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> 
      count<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;constructor&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// getDerivedStateFromProps 会在调⽤ render ⽅法之前调⽤， </span>
    <span class="token comment">//并且在初始挂载及后续更新时都会被调⽤。</span>
		<span class="token comment">//它应返回⼀个对象来更新 state，如果返回 null 则不更新任何内容。 </span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;getDerivedStateFromProps&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> count <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> 
	<span class="token comment">//在render之后，在componentDidUpdate之前。</span>
	<span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> snapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> prevState<span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;getSnapshotBeforeUpdate&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 

	<span class="token comment">/* UNSAFE_componentWillMount() {
		//不推荐，将会被废弃
		console.log(&quot;componentWillMount&quot;, this.state.count); 
	} */</span> 

	<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;componentDidMount&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 

	<span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//组件卸载之前</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;componentWillUnmount&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 

	<span class="token comment">/* UNSAFE_componentWillUpdate() {
		//不推荐，将会被废弃
		console.log(&quot;componentWillUpdate&quot;, this.state.count); 
  } */</span> 
	
	<span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;componentDidUpdate&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>

	<span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> nextState<span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;shouldComponentUpdate&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">,</span> nextState<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> count <span class="token operator">!==</span> <span class="token number">3</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>

	<span class="token function-variable function">setCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;render&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>我是LifeCycle⻚页⾯<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>setCount<span class="token punctuation">}</span><span class="token operator">&gt;</span>改变count<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
				<span class="token punctuation">{</span><span class="token comment">/* {!!(count % 2) &amp;&amp; &lt;Foo /&gt;} */</span><span class="token punctuation">}</span> 
				<span class="token operator">&lt;</span>Child count<span class="token operator">=</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
	<span class="token function">UNSAFE_componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">//不推荐，将会被废弃 </span>
    <span class="token comment">// UNSAFE_componentWillReceiveProps() 会在已挂载的组件接收新的 props 之前被调⽤ </span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Foo componentWillReceiveProps&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
  
  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">//组件卸载之前 </span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot; Foo componentWillUnmount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span> 
      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> border<span class="token punctuation">:</span> <span class="token string">&quot;solid 1px black&quot;</span><span class="token punctuation">,</span> margin<span class="token punctuation">:</span> <span class="token string">&quot;10px&quot;</span><span class="token punctuation">,</span> padding<span class="token punctuation">:</span> <span class="token string">&quot;10px&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">&gt;</span> 
      	我是Foo组件 
				<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Foo count<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="组件复合"><a href="#组件复合" aria-hidden="true" class="header-anchor">#</a> 组件复合</h2> <h3 id="目标-6"><a href="#目标-6" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <ul><li>掌握组件化开发中的实现技术之一：组件复合 - Composition</li></ul> <h3 id="知识要点-2"><a href="#知识要点-2" aria-hidden="true" class="header-anchor">#</a> 知识要点</h3> <ul><li>组件复合 - Composition</li></ul> <h3 id="资源-6"><a href="#资源-6" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <ul><li><a href="https://zh-hans.reactjs.org/docs/composition-vs-inheritance.html" target="_blank" rel="noopener noreferrer">组合 vs 继承<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="起步-5"><a href="#起步-5" aria-hidden="true" class="header-anchor">#</a> 起步</h3> <p>复合组件给与你⾜够的敏捷去定义⾃定义组件的外观和⾏为，这种⽅式更明确和安全。如果组件间有公⽤的⾮ UI 逻辑，将它们抽取为 JS 模块导⼊使⽤⽽不是继承它。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggac01xcibj30k60nawmt.jpg" alt="image-20200630150926992"></p> <h3 id="不具名"><a href="#不具名" aria-hidden="true" class="header-anchor">#</a> 不具名</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将公共部分抽象出来</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> TopBar <span class="token keyword">from</span> <span class="token string">&quot;../components/TopBar&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> BottomBar <span class="token keyword">from</span> <span class="token string">&quot;../components/BottomBar&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Layout</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span> 
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> title <span class="token operator">=</span> <span class="token string">'商城'</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> title
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> <span class="token punctuation">{</span> children<span class="token punctuation">,</span> showTopBar<span class="token punctuation">,</span> showBottomBar <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;children&quot;</span><span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span> 
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
      	<span class="token punctuation">{</span>showTopBar <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>TopBar <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span> 
      	<span class="token punctuation">{</span>children<span class="token punctuation">.</span>content<span class="token punctuation">}</span> 
  			<span class="token punctuation">{</span>children<span class="token punctuation">.</span>txt<span class="token punctuation">}</span> 
				<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>children<span class="token punctuation">.</span>btnClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>button<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
				<span class="token punctuation">{</span>showBottomBar <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>BottomBar <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span> 
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
   	<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">&quot;./Layout&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">UserPage</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span> 
      <span class="token operator">&lt;</span>Layout showTopBar<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span> showBottomBar<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span> title<span class="token operator">=</span><span class="token string">&quot;⽤户中⼼&quot;</span><span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
      		<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>UserPage<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span> 
				<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span> 
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="具名"><a href="#具名" aria-hidden="true" class="header-anchor">#</a> 具名</h3> <p>参照 vue 的具名插槽，传个对象进去：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">&quot;./Layout&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">HomePage</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span> 
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>Layout showTopBar<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span> showBottomBar<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span> title<span class="token operator">=</span><span class="token string">&quot;商城⾸⻚页&quot;</span><span class="token operator">&gt;</span> 
        <span class="token punctuation">{</span><span class="token comment">/* &lt;div&gt; 
              &lt;h3&gt;HomePage&lt;/h3&gt; 
            &lt;/div&gt; */</span><span class="token punctuation">}</span> 
        <span class="token punctuation">{</span><span class="token punctuation">{</span> 
          content<span class="token punctuation">:</span> <span class="token punctuation">(</span> 
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
              <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>HomePage<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span> 
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
          <span class="token punctuation">)</span><span class="token punctuation">,</span> 
          txt<span class="token punctuation">:</span> <span class="token string">&quot;这是个⽂本&quot;</span><span class="token punctuation">,</span> 
          <span class="token function-variable function">btnClick</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;btnClick&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span><span class="token punctuation">}</span> 
			<span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span> 
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实现一个简单的复合组件，如 antD 的 Card</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">Card</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&lt;</span>div xu<span class="token operator">=</span><span class="token string">&quot;card&quot;</span><span class="token operator">&gt;</span> 
    <span class="token punctuation">{</span> 
    	props<span class="token punctuation">.</span>children 
  	<span class="token punctuation">}</span> 
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Formbutton</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">return</span> 
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;Formbutton&quot;</span><span class="token operator">&gt;</span> 
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">.</span>defaultBtns<span class="token punctuation">.</span>searchClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>默认查询<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">.</span>defaultBtns<span class="token punctuation">.</span>resetClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>默认重置<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
      <span class="token punctuation">{</span> 
        props<span class="token punctuation">.</span>children<span class="token punctuation">.</span>btns<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
          <span class="token keyword">return</span> <span class="token operator">&lt;</span>button key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'btn'</span> <span class="token operator">+</span> index<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>onClick<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
        <span class="token punctuation">}</span><span class="token punctuation">)</span> 
      <span class="token punctuation">}</span> 
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">CompositionPage</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span> 
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
  		<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Card<span class="token operator">&gt;</span> 
      		<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>我是内容<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span> 
      	CompositionPage 
      	<span class="token operator">&lt;</span>Card<span class="token operator">&gt;</span> 
      		<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>我是内容<span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>Formbutton<span class="token operator">&gt;</span> 
      		<span class="token punctuation">{</span><span class="token punctuation">{</span> 
      			<span class="token comment">/* btns: ( 
      				&lt;&gt; 
      					&lt;button onClick={() =&gt; console.log('enn')}&gt;查询&lt;/button&gt; 
      					&lt;button onClick={() =&gt; console.log('enn2')}&gt;查询2&lt;/button&gt; 
      				&lt;/&gt; ) */</span> 
          defaultBtns<span class="token punctuation">:</span> <span class="token punctuation">{</span> 
            <span class="token function-variable function">searchClick</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'默认查询'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            <span class="token function-variable function">resetClick</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'默认重置'</span><span class="token punctuation">)</span> 
          <span class="token punctuation">}</span><span class="token punctuation">,</span> 
          btns<span class="token punctuation">:</span> <span class="token punctuation">[</span> 
            <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'查询'</span><span class="token punctuation">,</span> <span class="token function-variable function">onClick</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'查询'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
            <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'重置'</span><span class="token punctuation">,</span> <span class="token function-variable function">onClick</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'重置'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span> 
        <span class="token punctuation">}</span><span class="token punctuation">}</span> 
      	<span class="token operator">&lt;</span><span class="token operator">/</span>Formbutton<span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="redux"><a href="#redux" aria-hidden="true" class="header-anchor">#</a> Redux</h2> <h3 id="目标-7"><a href="#目标-7" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <ul><li>什么时候才需要 Redux</li> <li>掌握 Redux 基本用法</li></ul> <h3 id="资源-7"><a href="#资源-7" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <ul><li><a href="https://www.redux.org.cn/" target="_blank" rel="noopener noreferrer">Redux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="你可能不需要-redux"><a href="#你可能不需要-redux" aria-hidden="true" class="header-anchor">#</a> 你可能不需要 Redux</h3> <p>Redux 是负责组织 state 的工具，但你也要考虑它是否适合你的情况，不要因为有人告诉你要用 Redux 就去用，花点时间想一想使用 Redux 的好处与坏处。</p> <p>在下列场景中，引入 Redux 是比较明智的：</p> <ul><li>你有着相当大的、随时间变化的数据</li> <li>你的 state 需要有一个单一可靠数据来源</li> <li>你觉得把所有 state 放在最顶层组件中已经无法满足需要了</li> <li>某个组件的状态需要共享</li></ul> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggaev5dg3dj30l00bhjsc.jpg" alt="image-20200630164843942"></p> <h3 id="redux-2"><a href="#redux-2" aria-hidden="true" class="header-anchor">#</a> Redux</h3> <p>Redux 是 JavaScript 应用的状态容器，提供可预测化的状态管理，它保证程序行为一致性且易于测试。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggaewg73u1j30m10fomyu.jpg" alt="image-20200630164958614"></p> <h3 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h3> <div class="language-js extra-class"><pre class="language-js"><code>npm install redux <span class="token operator">--</span>save
</code></pre></div><h3 id="上手"><a href="#上手" aria-hidden="true" class="header-anchor">#</a> 上手</h3> <p>制作一个累加器</p> <ol><li>需要 store 存储数据</li> <li>store 里的 reducer 初始化 state 并定义 state 修改规则</li> <li>通过 dispatch 一个 action 来提交对数据的修改</li> <li>action 提交到 reducer 函数里，根据传入的 action 的 type，返回新的 state</li></ol> <p>创建 store：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/store/ReduxStore.js</span>

<span class="token keyword">const</span> <span class="token function-variable function">counterReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">case</span> <span class="token string">'ADD'</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span> 
    <span class="token keyword">case</span> <span class="token string">'MINUS'</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span> 
    <span class="token keyword">default</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> state
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>counterReducer<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store
</code></pre></div><p>创建 ReduxPage：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;../store/ReduxStore&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">ReduxPage</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span> 
	<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;subscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//this.setState({}); </span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> 
  <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&quot;ADD&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
	<span class="token function-variable function">minus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&quot;MINUS&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;store&quot;</span><span class="token punctuation">,</span> store<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span> 
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>ReduxPage<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
				<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>add<span class="token punctuation">}</span><span class="token operator">&gt;</span>add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
				<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>minus<span class="token punctuation">}</span><span class="token operator">&gt;</span>minus<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>如果点击按钮不能更新，是因为没有订阅（subscribe）状态变更</p></blockquote> <p>还可以在 <code>src/index.js</code> 的 <code>render</code> 里订阅状态变更</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/ReduxStore'</span> 
<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

	ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span> 
    <span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> 
    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span> 
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
</code></pre></div><h3 id="检查点"><a href="#检查点" aria-hidden="true" class="header-anchor">#</a> 检查点</h3> <ol><li><code>createStore</code> 创建 <code>store</code></li> <li><code>reducer</code> 初始化、修改状态函数</li> <li><code>getState</code> 获取状态值</li> <li><code>dispatch</code> 提交更新</li> <li><code>subscribe</code> 变更订阅</li></ol> <h2 id="react-redux"><a href="#react-redux" aria-hidden="true" class="header-anchor">#</a> React-Redux</h2> <h3 id="目标-8"><a href="#目标-8" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <ul><li>掌握 react-redux</li></ul> <h3 id="资源-8"><a href="#资源-8" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <ul><li><a href="https://www.redux.org.cn/docs/react-redux/" target="_blank" rel="noopener noreferrer">react-redux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="要点"><a href="#要点" aria-hidden="true" class="header-anchor">#</a> 要点</h3> <h3 id="安装-2"><a href="#安装-2" aria-hidden="true" class="header-anchor">#</a> 安装</h3> <div class="language-js extra-class"><pre class="language-js"><code>npm install react<span class="token operator">-</span>redux <span class="token operator">--</span>save
</code></pre></div><h3 id="使用-react-redux"><a href="#使用-react-redux" aria-hidden="true" class="header-anchor">#</a> 使用 react-redux</h3> <p>react-redux 提供了两个 api</p> <ol><li>Provider 为后代组件提供 store</li> <li>connect 为组件提供数据和变更方法</li></ol> <p>全局提供 store：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>

<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span> 
<span class="token keyword">import</span> ReactDom <span class="token keyword">from</span> <span class="token string">'react-dom'</span> 
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span> 
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/'</span> 
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>

ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span> 
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span> 
  	<span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">&gt;</span> 
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span> 
	document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span>
</code></pre></div><p>获取状态数据：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ReactReduxPage.js</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ReactReduxPage</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">const</span> <span class="token punctuation">{</span> num<span class="token punctuation">,</span> add<span class="token punctuation">,</span> minus <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span> 
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>ReactReduxPage<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>add<span class="token punctuation">}</span><span class="token operator">&gt;</span>add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
				<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>minus<span class="token punctuation">}</span><span class="token operator">&gt;</span>minus<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
	<span class="token keyword">return</span> <span class="token punctuation">{</span> 
    num<span class="token punctuation">:</span> state<span class="token punctuation">,</span> 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">const</span> mapDispatchToProps <span class="token operator">=</span> <span class="token punctuation">{</span> 
  <span class="token function-variable function">add</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&quot;add&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token function-variable function">minus</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&quot;minus&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
	mapStateToProps<span class="token punctuation">,</span> <span class="token comment">//状态映射 </span>
  mapStateToProps mapDispatchToProps<span class="token punctuation">,</span> <span class="token comment">//派发事件映射 </span>
<span class="token punctuation">)</span><span class="token punctuation">(</span>ReactReduxPage<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>connect 中的参数：state 映射和事件映射</p></blockquote> <h2 id="react-router"><a href="#react-router" aria-hidden="true" class="header-anchor">#</a> React-Router</h2> <h3 id="目标-9"><a href="#目标-9" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <ul><li>掌握 react-router</li></ul> <h3 id="资源-9"><a href="#资源-9" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <ul><li><a href="https://reacttraining.com/react-router/web/guides/quick-start" target="_blank" rel="noopener noreferrer">react-router<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://react-guide.github.io/react-router-cn/index.html" target="_blank" rel="noopener noreferrer">react-router 中文文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="要点-2"><a href="#要点-2" aria-hidden="true" class="header-anchor">#</a> 要点</h3> <h3 id="react-router-2"><a href="#react-router-2" aria-hidden="true" class="header-anchor">#</a> react-router</h3> <p>react-router 包含三个库：</p> <ol><li><code>react-router</code>：提供最基本的路由功能，实际不会直接安装 react-router</li> <li><code>react-router-dom</code>：</li> <li><code>react-router-native</code></li></ol> <p><code>react-router</code> 提供最 基本的路由功能，实际使⽤的时候我们不会直接安装 <code>react-router</code>，⽽是根据应⽤运⾏的环境选择安装 <code>react-router-dom</code>（在浏览器中使⽤）或 <code>react-router-native</code>（在 rn 中使⽤）。<code>react-router-dom</code> 和 <code>react-router-native</code> 都依赖 <code>react-router</code>，所以在安装时，<code>react-router</code> 也会⾃动安装，创建web应⽤， 使⽤：</p> <h3 id="安装-3"><a href="#安装-3" aria-hidden="true" class="header-anchor">#</a> 安装</h3> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">--</span>save react<span class="token operator">-</span>router<span class="token operator">-</span>dom
</code></pre></div><h3 id="基本使用-2"><a href="#基本使用-2" aria-hidden="true" class="header-anchor">#</a> 基本使用</h3> <p>react-router 中风行一切皆组件的思想，路由器 -Router、链接 -Link、路由 -Route、独占 -Switch、重定向 -Redirect 都以组件形式存在、</p> <p>创建 RouterPage.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token keyword">as</span> Router<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">RouterPage</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span> 
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span> 
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>RouterPage<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>Router<span class="token operator">&gt;</span> 
      		<span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span>⾸⻚页<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span> 
      		<span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/user&quot;</span><span class="token operator">&gt;</span>⽤户中⼼<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
					
      		<span class="token punctuation">{</span><span class="token comment">/* 根路由要添加exact，实现精确匹配 */</span><span class="token punctuation">}</span> 
  				<span class="token operator">&lt;</span>Route 
						exact 
            path<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> 
						component<span class="token operator">=</span><span class="token punctuation">{</span>HomePage<span class="token punctuation">}</span> 
						<span class="token comment">//children={() =&gt; &lt;div&gt;children&lt;/div&gt;} </span>
						<span class="token comment">//render={() =&gt; &lt;div&gt;render&lt;/div&gt;} </span>
						<span class="token operator">/</span><span class="token operator">&gt;</span> 
          <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/user&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span>UserPage<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span> 
        <span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">HomePage</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span> 
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span> 
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>HomePage<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span> 
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">UserPage</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span> 
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span> 
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>UserPage<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="route-渲染内容三种方式"><a href="#route-渲染内容三种方式" aria-hidden="true" class="header-anchor">#</a> Route 渲染内容三种方式</h3> <p>Route 渲染优先级：children &gt; component &gt; render</p> <p>这三种方法互斥，只能选择其中一种</p> <h3 id="children-func"><a href="#children-func" aria-hidden="true" class="header-anchor">#</a> children: func</h3> <p>有时候，不管 location 是否匹配，你都需要渲染⼀些内容，这时候你可以⽤ children</p> <p>除了不管 location 是否匹配都会被渲染之外，其它⼯作⽅法与 render 完全⼀样</p> <h3 id="render-func"><a href="#render-func" aria-hidden="true" class="header-anchor">#</a> render:  func</h3> <p>当你⽤ render 的时候，你调⽤的只是个函数。</p> <p>只在当 location 匹配的时候渲染</p> <h3 id="component-component"><a href="#component-component" aria-hidden="true" class="header-anchor">#</a> component: component</h3> <p>只在当 location 匹配的时候渲染</p> <h3 id="_404-页面"><a href="#_404-页面" aria-hidden="true" class="header-anchor">#</a> 404 页面</h3> <p>设定⼀个没有 path 的路由在路由列表最后⾯，表示⼀定匹配</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span><span class="token comment">/* 添加Switch表示仅匹配⼀个*/</span><span class="token punctuation">}</span> 
<span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span> 
	<span class="token punctuation">{</span><span class="token comment">/* 根路由要添加exact，实现精确匹配 */</span><span class="token punctuation">}</span> 
	<span class="token operator">&lt;</span>Route 
		exact 
    path<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> 
		component<span class="token operator">=</span><span class="token punctuation">{</span>HomePage<span class="token punctuation">}</span> 
		<span class="token operator">/</span><span class="token operator">&gt;</span> 
  <span class="token operator">&lt;</span>Route 
		path<span class="token operator">=</span><span class="token string">&quot;/user&quot;</span> 
		component<span class="token operator">=</span><span class="token punctuation">{</span>UserPage<span class="token punctuation">}</span> 
		<span class="token operator">/</span><span class="token operator">&gt;</span> 
  <span class="token operator">&lt;</span>Route 
		component<span class="token operator">=</span><span class="token punctuation">{</span>EmptyPage<span class="token punctuation">}</span> 
		<span class="token operator">/</span><span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span>

<span class="token keyword">class</span> <span class="token class-name">EmptyPage</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span> 
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span> 
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>EmptyPage<span class="token operator">-</span><span class="token number">404</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="purecomponent"><a href="#purecomponent" aria-hidden="true" class="header-anchor">#</a> PureComponent</h2> <h3 id="目标-10"><a href="#目标-10" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <ul><li>掌握 PureComponent 使用，实现性能优化</li> <li>掌握 PureComponent 原理</li></ul> <h3 id="资源-10"><a href="#资源-10" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <ul><li><a href="https://zh-hans.reactjs.org/docs/react-api.html#reactpurecomponent" target="_blank" rel="noopener noreferrer">React.PureComponent<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="知识点"><a href="#知识点" aria-hidden="true" class="header-anchor">#</a> 知识点</h3> <h3 id="实现功能优化"><a href="#实现功能优化" aria-hidden="true" class="header-anchor">#</a> 实现功能优化</h3> <p>定制了 shouldComponentUpdate 后的 Component：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">PureComponentPage</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span> 							<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  	<span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  	<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> 
      counter<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
      <span class="token comment">// obj: { </span>
      <span class="token comment">// 		num: 2, </span>
      <span class="token comment">// }, </span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function-variable function">setCounter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
      counter<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> 
      <span class="token comment">// obj: { </span>
      <span class="token comment">// 		num: 200, </span>
      <span class="token comment">// }, </span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> <span class="token punctuation">{</span> counter<span class="token punctuation">,</span> obj <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;render&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>PuerComponentPage<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>setCounter<span class="token punctuation">}</span><span class="token operator">&gt;</span>counter<span class="token punctuation">:</span> <span class="token punctuation">{</span>counter<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="浅比较"><a href="#浅比较" aria-hidden="true" class="header-anchor">#</a> 浅⽐较</h3> <p>缺点是必须要⽤ class 形式，⽽且要注意是浅⽐较（无法应对复杂对象）</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggahexyjbxj30k90kh126.jpg" alt="image-20200630181706645"></p> <h3 id="与component"><a href="#与component" aria-hidden="true" class="header-anchor">#</a> 与Component</h3> <p><code>React.PureComponent</code> 与 <code>React.Component</code> 很相似。两者的区别在于 <code>React.Component</code> 并未实 现 <code>shouldComponentUpdate()</code> ，⽽ <code>React.PureComponent</code> 中以浅层对⽐ <code>prop</code> 和 <code>state</code> 的⽅式来实现了该函数。</p> <p>如果赋予 <code>React</code> 组件相同的 <code>props</code> 和 <code>state</code>， <code>render()</code> 函数会渲染相同的内容，那么在某些情况下使 ⽤ <code>React.PureComponent</code> 可提⾼性能。</p> <blockquote><p>注意</p> <p><code>React.PureComponent</code> 中的 <code>shouldComponentUpdate()</code> 仅作对象的浅层⽐较。如果对象中含复杂的数据结构，则有可能因为⽆法检查深层的差别，产⽣错误⽐对结果。仅在 <code>props</code> 和 <code>state</code> 较为简单时才使⽤ <code>React.PureComponent</code> ，或者在深层数据结构发⽣变化时 调⽤ <code>forceUpdate()</code> 来确保组件被正确地更新。你也可以考虑使⽤ <code>immutable</code> 对象加速嵌套数据的⽐较。</p> <p>此外， React.PureComponent 中的 shouldComponentUpdate() 将跳过所有⼦组件树的 prop 更新。因此，请确保所有⼦组件也都是“纯”的组件。</p></blockquote> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggahjpmb0gj30dn072gou.jpg" alt="image-20200630182142096"></p> <h2 id="认识-hook"><a href="#认识-hook" aria-hidden="true" class="header-anchor">#</a> 认识 Hook</h2> <h3 id="目标-11"><a href="#目标-11" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <ul><li>掌握 hook 基本实用</li></ul> <h3 id="资源-11"><a href="#资源-11" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <ul><li><a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener noreferrer">Hook 简介<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Hook 视频介绍 <a href="https://www.youtube.com/watch?v=V-QO-KO90iQ&amp;t=3060s" target="_blank" rel="noopener noreferrer">React Today and Tomorrow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="知识点-2"><a href="#知识点-2" aria-hidden="true" class="header-anchor">#</a> 知识点</h3> <h3 id="认识-hook-2"><a href="#认识-hook-2" aria-hidden="true" class="header-anchor">#</a> 认识 Hook</h3> <p>Hook 是什么？ Hook 是⼀个特殊的函数，它可以让你“钩⼊” React 的特性。例如， useState 是允许 你在 React 函数组件中添加 state 的 Hook</p> <p>什么时候我会⽤ Hook？ 如果你在编写函数组件并意识到需要向其添加⼀些 state，以前的做法是必须 将其它转化为 class。现在你可以在现有的函数组件中使⽤ Hook</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">HookPage</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 声明⼀个叫 “count” 的 state 变量，初始化为0 </span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span> 
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>HookPage<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id=""><a href="#" aria-hidden="true" class="header-anchor">#</a></h3> <h3 id="使用-effect-hook"><a href="#使用-effect-hook" aria-hidden="true" class="header-anchor">#</a> 使用 Effect Hook</h3> <p>Eﬀect Hook 可以让你在函数组件中执⾏副作⽤操作。</p> <p>数据获取，设置订阅以及⼿动更改 React 组件中的 DOM 都属于副作⽤。不管你知不知道这些操作，或是“副作⽤”这个名字，应该都在组件中使⽤过它们。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">HookPage</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 声明⼀个叫 “count” 的 state 变量，初始化为0 </span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token comment">// 与 componentDidMount 和 componentDidUpdate相似 </span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token comment">// 更新 title</span>
		document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token punctuation">(</span> 
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>HookPage<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在函数组件主体内（这⾥指在 React 渲染阶段）改变 DOM、添加订阅、设置定时器、记录⽇志以及执⾏其他包含副作⽤的操作都是不被允许的，因为这可能会产⽣莫名其妙的 bug 并破坏 UI 的⼀致性。</p> <p>使⽤ useEffect 完成副作⽤操作。赋值给 useEffect 的函数会在组件渲染到屏幕之后执⾏。你可以 把 eﬀect 看作从 React 的纯函数式世界通往命令式世界的逃⽣通道。</p> <p>默认情况下，eﬀect 将在每轮渲染结束后执⾏，但你可以选择让它在只有某些值改变的时候 才执⾏：https://zh-hans.reactjs.org/docs/hooks-reference.html#conditionally-firing-an-effect</p> <h3 id="effect-的条件执行"><a href="#effect-的条件执行" aria-hidden="true" class="header-anchor">#</a> effect 的条件执行</h3> <p>默认情况下，eﬀect 会在每轮组件渲染完成后执⾏。这样的话，⼀旦 eﬀect 的依赖发⽣变化，它就会被重新创建。</p> <p>然⽽，在某些场景下这么做可能会矫枉过正。⽐如，在上⼀章节的订阅示例中，我们不需要在每次组件更新时都创建新的订阅，⽽是仅需要在 source props 改变时重新创建。</p> <p>要实现这⼀点，可以给 useEffect 传递第⼆个参数，它是 eﬀect 所依赖的值数组。更新后的示例如 下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">HookPage</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 声明⼀个叫 “count” 的 state 变量，初始化为0 </span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">const</span> <span class="token punctuation">[</span>date<span class="token punctuation">,</span> setDate<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 与 componentDidMount 和 componentDidUpdate相似 </span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token comment">// 更新 title</span>
		document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
      <span class="token function">setDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 只在 mount 执行</span>
  
	<span class="token keyword">return</span> <span class="token punctuation">(</span> 
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>HookPage<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>date<span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="清除-effect"><a href="#清除-effect" aria-hidden="true" class="header-anchor">#</a> 清除 effect</h3> <p>通常，组件卸载时需要清除 eﬀect 创建的诸如订阅或计时器 ID 等资源。要实现这⼀点， useEffect 函数需返回⼀个清除函数，以防⽌内存泄漏，清除函数会在组件卸载前执⾏</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
	<span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token function">setDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="自定义-hook-与-hook-使用规则"><a href="#自定义-hook-与-hook-使用规则" aria-hidden="true" class="header-anchor">#</a> 自定义 Hook 与 Hook 使用规则</h2> <h3 id="目标-12"><a href="#目标-12" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <ul><li>掌握自定义 Hook 与 Hook 使用规则</li></ul> <h3 id="资源-12"><a href="#资源-12" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <ul><li><a href="https://zh-hans.reactjs.org/docs/hooks-custom.html" target="_blank" rel="noopener noreferrer">自定义 Hook<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zh-hans.reactjs.org/docs/hooks-rules.html" target="_blank" rel="noopener noreferrer">Hook 规则<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="知识点-3"><a href="#知识点-3" aria-hidden="true" class="header-anchor">#</a> 知识点</h3> <h3 id="自定义-hook"><a href="#自定义-hook" aria-hidden="true" class="header-anchor">#</a> 自定义 Hook</h3> <p>有时候我们会想要在组件之间重⽤⼀些状态逻辑。⽬前为⽌，有两种主流⽅案来解决这个问题：<a href="https://zh-hans.reactjs.org/docs/higher-order-components.html" target="_blank" rel="noopener noreferrer">⾼阶组件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和 <a href="https://zh-hans.reactjs.org/docs/render-props.html" target="_blank" rel="noopener noreferrer">render props<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，⾃定义 Hook 可以让你在不增加组件的情况下达到同样的⽬的。</p> <p>⾃定义 Hook 是⼀个函数，其名称以 “use” 开头，函数内部可以调⽤其他的 Hook</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">CustomHookPage</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token comment">//定义⼀个叫 count 的 state 变量，初始化为0 </span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token comment">//和didMount、didUpdate类似 </span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;count effect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// 只需要在 count 发⽣改变的时候执⾏就可以啦 </span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`点击了</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">次`</span></span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token punctuation">(</span> 
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>⾃定义Hook<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token function">useClock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//⾃定义hook，命名必须以use开头</span>
<span class="token keyword">function</span> <span class="token function">useClock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span>date<span class="token punctuation">,</span> setDate<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;date effect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//只需要在didMount时候执⾏就可以了 </span>
    <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
      <span class="token function">setDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//清除定时器，类似willUnmount </span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">return</span> date<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="hook-使用规则"><a href="#hook-使用规则" aria-hidden="true" class="header-anchor">#</a> Hook 使用规则</h3> <p>Hook 就是 JavaScript 函数，但是使用它们会有两个额外规则：</p> <ul><li>只能在<strong>函数最外层</strong>调用 Hook，不要在循环、条件判断或者子函数中调用</li> <li>只能在 <strong>React 的函数组件</strong>中调用 Hook，不要在其他 JavaScript 函数中调用（除了自定义 Hook）</li></ul> <h2 id="hook-api-之-usememo-与-usecallback"><a href="#hook-api-之-usememo-与-usecallback" aria-hidden="true" class="header-anchor">#</a> Hook API 之 useMemo 与 useCallback</h2> <h3 id="目标-13"><a href="#目标-13" aria-hidden="true" class="header-anchor">#</a> 目标</h3> <ul><li>掌握 useMemo、useCallback</li></ul> <h3 id="资源-13"><a href="#资源-13" aria-hidden="true" class="header-anchor">#</a> 资源</h3> <ul><li><a href="https://zh-hans.reactjs.org/docs/hooks-reference.html" target="_blank" rel="noopener noreferrer">HookAPI 索引<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="知识点-4"><a href="#知识点-4" aria-hidden="true" class="header-anchor">#</a> 知识点</h3> <h3 id="usememo"><a href="#usememo" aria-hidden="true" class="header-anchor">#</a> useMemo</h3> <p>把“创建”函数和依赖项数组作为参数传⼊ <code>useMemo</code> ，它仅会在某个依赖项改变时才重新计算 <code>memoized</code> 值。这种优化有助于避免在每次渲染时都进⾏⾼开销的计算。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseMemoPage</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">const</span> expensive <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;compute&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      sum <span class="token operator">+=</span> i<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span> 
    <span class="token comment">//只有count变化，这⾥才重新执⾏ </span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span> 
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>UseMemoPage<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
    	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>expensive<span class="token punctuation">:</span><span class="token punctuation">{</span>expensive<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token function">setValue</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span> 
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="usecallback"><a href="#usecallback" aria-hidden="true" class="header-anchor">#</a> useCallback</h3> <p>把内联回调函数及依赖项数组作为参数传⼊ <code>useCallback</code> ，它将返回该回调函数的 <code>memoized</code> 版本， 该回调函数仅在某个依赖项改变时才会更新。当你把回调函数传递给经优化的并使⽤引⽤相等性去避免⾮必要渲染（例如 <code>shouldComponentUpdate</code> ）的⼦组件时，它将⾮常有⽤</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseCallbackPage</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">const</span> addClick <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      sum <span class="token operator">+=</span> i<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">return</span> <span class="token punctuation">(</span> 
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>UseCallbackPage<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
    	<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token function">setValue</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span>Child addClick<span class="token operator">=</span><span class="token punctuation">{</span>addClick<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span> 
  	<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;child render&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">const</span> <span class="token punctuation">{</span> addClick <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span> 
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>Child<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span> 
      	<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">addClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> 
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><p><code>useCallback(fn, deps)</code> 相当于 <code>useMemo(() =&gt; fn, deps)</code></p> <blockquote><p>注意</p> <p>依赖项数组不会作为参数传给“创建”函数。虽然从概念上来说它表现为：所有“创建”函数中引⽤的 值都应该出现在依赖项数组中。未来编译器会更加智能，届时⾃动创建数组将成为可能。</p></blockquote></div> <footer class="page-edit" style="display:none;"><div class="edit-link"><a href="https://github.com/hentai-miao/blog-vuepress/edit/master/docs/frontEnd/react/react01.md" target="_blank" rel="noopener noreferrer">编辑此页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最终更新于: </span> <span class="time">6/30/2020, 8:01:36 PM</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.f09e1a8f.js" defer></script><script src="/assets/js/3.6380eba5.js" defer></script><script src="/assets/js/1.86ff7d31.js" defer></script><script src="/assets/js/83.93f4c999.js" defer></script>
  </body>
</html>
